# Survey of Consistent Software-Defined Network  @IEEE

## The Network Update Problem

- Flexibility  灵活的更新场景
  - 安全策略变化：限制某些流经过防火墙，或者防止敏感流的访问等。
  - 流量工程：为了提升性能（最小化链路负载），重路由流量的转发路径。
  - 维护工作：更换故障的交换机
  - 链路/结点故障：现在的网络种很容易发生链路和结点故障，对故障点进行快速的恢复。
  - 服务重定位：中间件、应用程序等服务的添加、删除或重新定位，需要重新路由受影响服务的流量。
- Maintaining consistency
  - per-packet path consistency: 每个数据包只能被旧或新路径处理转发。
  - waypoint enforcement: 数据包必须经过防火墙。
  - correct packet delivery：任何时候包都不会被丢弃和进入环路。
- Towards SDNs
  - 上述的更新原因和采用的网络范型无关，传统网络也存在同样的问题。
  - sdn网络的数据/控制平面解耦灵活性，存在更为频繁的网络更新，例如对流量路径更细粒度和频繁的优化。
- 需求
  - 一致性：无环路、黑洞和拥塞，安全策略隔离等。
  - 性能：更新间隔，最大链路利用率等。

2011年发表的[51]Consistent updates for software-defined networks: Change you can believe in!和2012年的[52]Abstractions for network update是最早提出sdn中网络更新的文献。都关注per-packet一致性。

技术提案是基于两阶段更新机制（tag包）实现的，[42]中的部分工作基于两阶段更新实现。

[53]-[60]关注额外的一致性属性：无拥塞的更新，包括SWAN、zUpdate、Dionysus等工作。

[61]-[64]通过计算一组有序的规则替换，用于处理特殊的更新场景，例如只需要转发一致性，可以避免额外的规则开销，节省资源（TCAM昂贵）。**这几篇我还没看过**

## Generalized Network Update Problem(GNUP)

**Basic Problem**: 网络更新问题在于计算一系列操作，这些操作改变安装在交换机设备上的规则。给定一个初始和目标状态，通过应用系列操作（adding、removing和changing rules）从初始状态转换到目标状态。

**Operations**：为了实现更新，需要计算出一系列操作。

**Consistency**：解决网络更新问题的困难在于更新期间为了满足特殊的需求，需要保证的一致性。

- 需要增量式的网络更新
- 需要操作序列的计算方法，对特定问题的解决算法。如某些设备的规则更新需要满足一定的顺序。

**Performance**: 优化网络更新的性能也是一大算法挑战。如优化更新时间，在更新过程中实现增量式更新需要安装中间状态，也有很多case是减小中间状态的时间开销。

**Final Operational Sequence**: 通常，一个更新问题的解决方案可以用一系列steps或者rounds表示，保证一致性，优化性能。每一个step是在同一时间可以并行执行安装的一系列操作。

**分类总结**：更新问题包括网络配置，一致性属性和性能目标。也从这几个方面去分类

- 规则粒度
  - Destination-based routing：只匹配目的ip
  - per-flow routing：匹配源和目的   √
- 操作
  - 规则替换：可以是per-rule和per-device的，也可以是per-group的rule和devices。
  - 规则添加
    - 2-phase commit
    - helper rules：处于中间状态的转发流量规则
  - 混合的规则替换和添加  √
- 一致性属性
  - 连接一致性：无黑洞[62]和环路[64]，都满足[65]
  - 策略一致性【51】：需要满足特殊的转发策略，如关键节点的遍历【67】，或者单包一致性【52】。
  - 资源容量一致性【53，SWAN】：如考虑链路容量，避免拥塞【55】问题。latency-aware【68，timed-update, chronicle】
- 性能目标
  - 基于链路【69】：最大化可以同时更新且不违反一致性的交换机规则数量（结点排序算法）
  - 基于次数round【70】：最小化更新阶段轮数（结点排序算法）
  - 交叉流【57，Dionysus】：多条流的更新协议
    - Augmentation?: 无拥塞【60，ICNP15】
    - Touches?: 最小化交换机交互次数【71，NCA17】

## 保证连接一致性更新机制

Loop-freedom

1）定义

- Strong loop-freedom：在任何时候，存储在交换机上的规则都不存在环路【65，基于目的ip的路由，无tag】
- Relaxed loop-freedom：沿着路径从源到目的，交换机上的规则不存在环路   更快

2）算法及复杂性

- 基于结点（每次尽可能更新多的结点和链路）-贪心的方法
- 基于回合(controller和switch的交互次数)：扩展【64、7】的【74，PODC15】这篇文章把更新问题看作一个有向图的优化问题。
- 基于多策略和多流的更新：【61】和【71】

3）相关优化问题：minimum hitting set problem【69】，feedback arc set problem【56】

Black-freedom

如果当前的流都不存在黑洞，那么以高优先级安装新规则，然后再删除旧规则【62，65】。但是在内存限制和保证环路的情况下，找到快速的黑洞自由的更新调度是NP难的。

## 保证策略一致性更新机制

1）定义

- PPC：单包一致性，只能走新/旧路径，有时不需要
- WEP：waypoint enforcement，关键结点遍历
- 必须走某些子路径：例如ISP的视频流量走低时延子路径

2）算法和复杂性

- 两阶段更新：PPC【51，52】，为了解决两套规则的存储开销问题，【80】提出了增量式的两阶段更新，将更新分为子更新。（例子还没看懂）

## 无拥塞一致性更新机制

Motivation：影响吞吐量，增加时延，严重影响用户体验或造成不可预估的经济损失。

1）定义
$$
F_{old} →F_{new}
$$
多用户流的转换之间，一致性被定义为不违反链路容量且不限制低于min(F_old，F_new)的流量。

[53，SWAN]介绍了一致性的流迁移模型：无论是使用更新前还是更新后的规则，都应该满足链路容量限制。

2）算法

分类依据：假设模型（流可分或不可分割），复杂性（计算和更新）

机制：slack容量或依赖图

- slack：最开始提出是在[53, SWAN]，在此基础上[58, zUpadte]也提出了更新算法。基本思路是如果所有链路又空闲容量slack s，一致性迁移需要  上取整（1/s）-1次更新。如：10%的链路空闲容量，需要9次更新，每次迁移10%的流量到新路径。
- LP-formulation：[53,SWAN]
- 依赖图：[57, Dionysus]考虑了交换机变化的更新时间，为每个更新构造依赖图，贪婪地发送更新当各自的前提满足时。当这种贪婪的遍历导致死锁时，流被限制速率以保证更新进行。
- 新路径&共同优化迁移：[54]提出来这样的观点，新的流路径不应该作为问题输入的一部分，而应该和迁移计划一起计算。[96，catalyst]就提出基于[57]改进的方法，利用冗余路径来优化更新回合数，结果取决于运行时条件。
- 结点排序：[102-104]通过源和目的来唯一识别流，而不是tagging。减少了复杂性，没有使用2阶段提交（交换机既存储新规则又存储旧规则）。

3)总结

- 如果流量只能按照给定的初始和目标状态传输，基于依赖图的调度是可行的[57, Dionysus]。
- 如果可以通过网络传输流量，则可以参考[54，55]的流量增加算法。
- 如果可以接受非多项式时间，寻找最短无拥塞的调度可以看作MIP问题[60，ICNP15]。
- 修改数据报头域（tag）可以解决一些场景的更新问题[102-104]，但是会牺牲策略一致性。

解决死锁：限制流速率[57] [60]，减少后台流量[53]

## 未来研究问题

### 弱一致性Relaxing consustency guarantees

宽松的一致性，有作者提出交换机的时钟同步，可以同时执行网络更新。PTP（Precision Time Protocol）协议适用于SDN网络[121，122]，实验可以达到微秒的精度，增加了网络中的通信开销。

[123]提出了定时一致性更新的概述，[68,118]研究时间一致性更新的使用，以防止流量迁移拥塞，[124,125]结合考虑了延迟。

时钟同步更新方法有诸多优点，但也不能保证数据包的一致性，不能防止网络交换机上不可预测的规则安装时间变化。由此也激发了基于预测的调度方法需求[130-NOMS16,131]。

### 分布式控制层面的更新

分布式控制层面的设计属于分布式系统问题。这部分跳过了没看。



## 相关工作

[154]和[61]减少了发送到数据平面的更新规则，通过减少冗余更新实现高效。

[57]根据交换机安装规则时延的不同动态调度更新。

